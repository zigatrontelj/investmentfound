---
title: "masterThesis"
output: html_document
date: '2022-11-29'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(tidyquant)
library(quantmod)
library(corrplot)
```


```{r}
stock_list <- tibble(selector = c("SPY", "XLC", "XLY", "XLP", "XLE", "XLF", "XLV", "XLI", "XLB", "XLRE", "XLK", "XLU"))

daily_returns <- stock_list %>%
  tq_get(get = "stock.prices", from = "2000-01-01", to = "2022-01-01")

quarterly_returns <- daily_returns %>% 
  group_by(selector) %>%
  tq_transmute(select     = adjusted, 
               mutate_fun = periodReturn, 
               period     = "quarterly", 
               col_rename = "quarterly.returns") %>% 
   mutate(qtr = quarter(date))

unpivot <- quarterly_returns %>% 
  pivot_wider(names_from = selector, values_from = quarterly.returns) %>% 
  select(-date)

```

# Quartrer 1
```{r}
unpivot %>% 
  filter(qtr == 1) %>% 
  select(-qtr) %>% 
  cor() %>% 
  corrplot(method = 'number')
```

# Quartrer 2
```{r}
unpivot %>% 
  filter(qtr == 2) %>% 
  select(-qtr) %>% 
  cor() %>% 
  corrplot(method = 'number')
```

# Quartrer 3
```{r}
unpivot %>% 
  filter(qtr == 3) %>% 
  select(-qtr) %>% 
  cor() %>% 
  corrplot(method = 'number')
```

# Quartrer 4
```{r}
unpivot %>% 
  filter(qtr == 4) %>% 
  select(-qtr) %>% 
  cor() %>% 
  corrplot(method = 'number')
```



```{r}
quarterly_returns %>%
    ggplot(aes(x = year(date), y = quarterly.returns, fill = selector)) +
    geom_bar(position = "dodge", stat = "identity") +
    labs(title = "FANG: Annual Returns", 
         subtitle = "Mutating at scale is quick and easy!",
         y = "Returns", x = "", color = "") +
    scale_y_continuous(labels = scales::percent) +
    coord_flip() +
    theme_tq() +
    scale_fill_tq()
```


